sourcing .bash_profile_caseOS
sourcing .bash_profile_unix
sourcing .bash_profile_caseLinux
sourcing .bash_profile_linux
sourcing .bash_profile_NIL
sourcing .bash_profile_4dfp
sourcing .bash_profile_pascal
         Local Configurations
         Docker
         NiftyPETx Development
         JETBRAINS
         MATLAB Development
         Freesurfer Configuration
         FSL Configuration
jjlee@pascal
[ DeepMRSeg ]$ nvidia-docker build -t jjleewustledu/deepmrseg_image:20220420 -f ./Dockerfile ./
Sending build context to Docker daemon  347.1MB
Step 1/15 : FROM tensorflow/tensorflow:2.3.3-gpu-jupyter
 ---> 3de80349ed84
Step 2/15 : LABEL maintainer="John J. Lee <www.github.com/jjleewustledu>"
 ---> Using cache
 ---> c7853900a387
Step 3/15 : ENV LANG=C.UTF-8 LC_ALL=C.UTF-8
 ---> Using cache
 ---> 8fbe27137177
Step 4/15 : ENV	DEBIAN_FRONTEND=noninteractive
 ---> Using cache
 ---> cb53d93566c2
Step 5/15 : RUN	ln -fs /usr/share/zoneinfo/America/Chicago /etc/localtime
 ---> Using cache
 ---> 5fcf676cecb6
Step 6/15 : RUN apt-get update --fix-missing && apt-get install -y     apt-utils     wget     curl     bzip2     unzip     ca-certificates     build-essential     git-core     pkg-config     python-pip     python-setuptools     python-virtualenv     python3-tk     tree     &&     apt-get clean &&     rm -rf /var/lib/apt/lists/*
 ---> Using cache
 ---> 72a0d0509413
Step 7/15 : RUN mkdir /uufs /scratch
 ---> Using cache
 ---> 48a66ff5bc83
Step 8/15 : ENV HOME=/uufs
 ---> Using cache
 ---> 4e6e55139f27
Step 9/15 : ENV SHELL=/bin/bash
 ---> Using cache
 ---> 41a903ba24c6
Step 10/15 : VOLUME /scratch
 ---> Using cache
 ---> b5dad4383940
Step 11/15 : RUN	python -c "import tensorflow as tf;s = tf.constant( 1.0, tf.float32 )"
 ---> Using cache
 ---> e9deeef2ac31
Step 12/15 : RUN	mkdir -p /opt/cbica/src/deepmrseg && 	cd /opt/cbica/src/deepmrseg && 	git clone https://github.com/CBICA/DeepMRSeg.git && 	cd DeepMRSeg && 	python setup.py install && 	rm -rf /opt/cbica/src/deepmrseg && 	rmdir /opt/cbica/src /opt/cbica
 ---> Using cache
 ---> 1274c52251de
Step 13/15 : RUN deepmrseg_downloadmodel --model dlicv &&     tree ~/.deepmrseg
 ---> Using cache
 ---> 63070c23d673
Step 14/15 : WORKDIR /scratch
 ---> Using cache
 ---> f5c571b9a329
Step 15/15 : ENTRYPOINT ["deepmrseg_apply"]
 ---> Using cache
 ---> 971aabe0daf9
Successfully built 971aabe0daf9
Successfully tagged jjleewustledu/deepmrseg_image:20220420
jjlee@pascal
[ DeepMRSeg ]$ nvidia-docker run -it -v $(pwd):/scratch --rm jjleewustledu/deepmrseg_image:20220420 --task dlicv --inImg bert_T1.nii.gz --outImg bert_T1_DLICV.nii.gz
['--inImg', 'bert_T1.nii.gz', '--outImg', 'bert_T1_DLICV.nii.gz', '--mdlDir', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/LPS', '--mdlDir', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/PSL', '--mdlDir', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/SLP']
Calling deepmrseg_test

Hostname	: 72a7a8509a13
Start time	: Wed Apr 20 18:51:06 2022

Parsing args    : ['/usr/local/bin/deepmrseg_apply', '--inImg', 'bert_T1.nii.gz', '--outImg', 'bert_T1_DLICV.nii.gz', '--mdlDir', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/LPS', '--mdlDir', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/PSL', '--mdlDir', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/SLP']

Namespace(batch=64, inDir=None, inImg=['bert_T1.nii.gz'], inSuff='.nii.gz', mdlDir=['/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/LPS', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/PSL', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/SLP'], nJobs=None, outDir=None, outImg='bert_T1_DLICV.nii.gz', outSuff='_SEG.nii.gz', probs=False, sList=None, tmpDir=None)

Model dir(s) 	: ['/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/LPS', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/PSL', '/uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/SLP']

Input image(s) 	: bert_T1.nii.gz
Output image 	: bert_T1_DLICV.nii.gz

Batch Size 	: 64
Output probs 	: 0
Number of jobs 	: 32
Temp folder 	: /tmp/deepmrseg_test_l3r0j43i



---->	Model 1
	-->	Rescale Method 	: norm
	-->	XY width 	: 256
	-->	Voxel Size 	: 1.000000
	-->	Orientation 	: LPS
	-->	Loading all stored models in model path 1 : /uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/LPS
		-->	Loading  model-103
		-->	Loading  model-89
		-->	Loading  model-133
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.


	--> Running predictions for all subjects in the FileList
		-->	Scan1
			--> Extracting and pre-processing image data
			--> Running inference
			--> Saving output



---->	Model 2
	-->	Rescale Method 	: norm
	-->	XY width 	: 256
	-->	Voxel Size 	: 1.000000
	-->	Orientation 	: PSL
	-->	Loading all stored models in model path 2 : /uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/PSL
		-->	Loading  model-131
		-->	Loading  model-88
		-->	Loading  model-109
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.


	--> Running predictions for all subjects in the FileList
		-->	Scan1
			--> Extracting and pre-processing image data
			--> Running inference
			--> Saving output



---->	Model 3
	-->	Rescale Method 	: norm
	-->	XY width 	: 256
	-->	Voxel Size 	: 1.000000
	-->	Orientation 	: LPS
	-->	Loading all stored models in model path 3 : /uufs/.deepmrseg/trained_models/dlicv/DeepMRSeg_DLICV_v1.0/SLP
		-->	Loading  model-86
		-->	Loading  model-95
		-->	Loading  model-63
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.
WARNING:tensorflow:No training configuration found in save file, so the model was *not* compiled. Compile it manually.


	--> Running predictions for all subjects in the FileList
		-->	Scan1
			--> Extracting and pre-processing image data
			--> Running inference
			--> Saving output



---->	Creating final predictions by combining output from each model



---->	Out image : /scratch/bert_T1_DLICV.nii.gz

Resource usage for this process
	etime 	: 8.14 mins
	utime 	: 450.3
	stime 	: 129.49
	maxrss 	: 6.42 GB
jjlee@pascal
[ DeepMRSeg ]$ nvidia-docker images
REPOSITORY                              TAG                      IMAGE ID       CREATED         SIZE
jjleewustledu/deepmrseg_cpu_image       20220416                 9b2b82a9671a   3 days ago      2.33GB
deepmrseg_cpu_image                     latest                   433c3f596f8c   3 days ago      2.32GB
jjleewustledu/deepmrseg_image           20220416                 bb2c186dcb48   3 days ago      4.74GB
jjleewustledu/deepmrseg_image           20220420                 971aabe0daf9   3 days ago      4.72GB
deepmrseg_image                         latest                   971aabe0daf9   3 days ago      4.72GB
nvidia/cuda                             11.6.2-devel-centos7     b93fa95d8cf7   12 days ago     4.84GB
ubuntu                                  18.04                    f5cbed4244ba   2 weeks ago     63.2MB
bash                                    latest                   f6cdab9d8531   2 weeks ago     13MB
nvidia/cuda                             10.1-devel-centos7       24c0f429003d   2 weeks ago     3.24GB
tensorflow/tensorflow                   latest-gpu-jupyter       cc9a9ae2a5af   2 months ago    5.99GB
python                                  3.6-slim                 c1e40b69532f   4 months ago    119MB
tensorflow/tensorflow                   2.3.3-jupyter            c3b01fc61f10   10 months ago   1.64GB
tensorflow/tensorflow                   2.3.3                    6ba287a278ad   10 months ago   1.47GB
tensorflow/tensorflow                   2.3.3-gpu-jupyter        3de80349ed84   10 months ago   3.25GB
jjlee@pascal
[ DeepMRSeg ]$ nvidia-docker push jjleewustledu/deepmrseg_image:20220420
The push refers to repository [docker.io/jjleewustledu/deepmrseg_image]

[1B20220420: digest: sha256:61e3f5429d521aa9a32238ed70c2c12312386cd868edb636c04328e80c1b684d size: 8063
jjlee@pascal
[ DeepMRSeg ]$ fsleyes bert_T1.nii.gz bert_T1_DLICV.nii.gz
jjlee@pascal
[ DeepMRSeg ]$ 